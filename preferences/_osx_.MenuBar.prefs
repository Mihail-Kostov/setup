#!/usr/bin/env zsh

OSX_MENU_EXTRAS="/System/Library/CoreServices/Menu\ Extras"

# hide the useless icons
if ls $HOME/Library/Preferences/ByHost/ | grep com.apple.systemuiserver &> /dev/null
then
  for domain in $HOME/Library/Preferences/ByHost/com.apple.systemuiserver.*
  do
    defaults write "${domain}" dontAutoLoad -array \
      "$OSX_MENU_EXTRAS/Displays.menu" \
      "$OSX_MENU_EXTRAS/TimeMachine.menu" \
      "$OSX_MENU_EXTRAS/User.menu"
  done
fi

# define icons you want in menu bar
defaults write com.apple.systemuiserver menuExtras -array \
  "$OSX_MENU_EXTRAS/TextInput.menu" \
  "$OSX_MENU_EXTRAS/Volume.menu" \
  "$OSX_MENU_EXTRAS/AirPort.menu" \
  "$OSX_MENU_EXTRAS/Bluetooth.menu" \
  "$OSX_MENU_EXTRAS/Battery.menu"

MENUMETERS_PATH="/opt/homebrew-cask/Caskroom/menumeters"
if ls $MENUMETERS_PATH &> /dev/null
then
  defaults write com.apple.systemuiserver menuExtras -array-add \
    "$MENUMETERS_PATH/latest/MenuMeters Installer.app/Contents/Resources/MenuMeters.prefPane/Contents/Resources/MenuMeterMem.menu" \
    "$MENUMETERS_PATH/latest/MenuMeters Installer.app/Contents/Resources/MenuMeters.prefPane/Contents/Resources/MenuMeterCPU.menu" \
    "$MENUMETERS_PATH/latest/MenuMeters Installer.app/Contents/Resources/MenuMeters.prefPane/Contents/Resources/MenuCracker.menu"
fi

ITSYCAL_PATH="/Applications/Itsycal.app"
if ls $ITSYCAL_PATH &> /dev/null
then
  defaults write com.apple.systemuiserver menuExtras -array-add \
    "$ITSYCAL_PATH/Contents/Resources/ItsycalExtra.menu" \
    "$ITSYCAL_PATH/Contents/Resources/MenuCracker.menu"
fi

# add clock after everything
defaults write com.apple.systemuiserver menuExtras -array-add \
  "$OSX_MENU_EXTRAS/Clock.menu"
